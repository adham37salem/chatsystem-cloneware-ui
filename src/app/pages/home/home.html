<div class="flex justify-center items-center min-h-screen bg-[#e3f7f3]">
  <div class="absolute top-0 w-full h-24 bg-gradient-to-r from-[#1ea884] to-[#33c5a0]"></div>
  <div class="relative w-4/5 max-w-5xl h-[95vh] bg-white shadow-2xl flex flex-row">
    <div class="flex flex-col justify-between items-center p-3 bg-[#eff3f8] w-16 h-full">
      <div>
        <i class="fa-solid fa-message cursor-pointer text-xl"></i>
      </div>
      <div class="flex flex-col items-center gap-4">
        <i class="fa-solid fa-user cursor-pointer text-lg" (click)="userProfile()"></i>
        <i class="fa-solid fa-door-open cursor-pointer text-lg" (click)="logout()"></i>
      </div>
    </div>

    <div class="p-4 border-r border-gray-200 w-64 bg-white">
      <app-chatlist [chats]="chats" (chatSelected)="chatSelected($event)"></app-chatlist>
    </div>

    <div class="flex flex-col w-full">
      <div class="flex items-center gap-4 bg-gray-100 w-full h-24 p-4 border-b border-gray-200">
        <div class="w-14 h-14 rounded-full bg-white overflow-hidden border border-gray-300 flex items-center justify-center">
          <img src="/user.png" alt="User" class="w-12 h-12 object-cover" />
        </div>
        @if (selectedChat) {
          <div class="flex flex-col">
            <span class="text-lg font-semibold text-gray-800">{{ selectedChat.name }}</span>
            <div class="flex items-center gap-2 text-sm text-gray-600">
              @if (selectedChat.recipientOnline) {
                <span class="inline-flex items-center gap-1">
                  <span class="inline-block w-2.5 h-2.5 rounded-full bg-green-500"></span>
                  Online
                </span>
              } @else {
                <span class="inline-flex items-center gap-1">
                  <span class="inline-block w-2.5 h-2.5 rounded-full bg-gray-400"></span>
                  Offline
                </span>
              }
            </div>
            <p class="text-xs text-gray-500 mt-1">
              Last Seen: <span class="font-medium text-gray-700">Today at 9:00</span>
            </p>
          </div>
        }
      </div>

      <div #scrollableDiv class="flex-1 bg-chat p-4 overflow-x-scroll">
        @for (message of chatMessages; track message) {
          @if (isSelfMessage(message)) {
            <div class="message-box self">
              <div class="flex flex-col">
                @if (message.type === 'TEXT') {
                  <span>{{ message.content }}</span>
                } @else if (message.media) {
                  <img width="200" [src]="'data:image/jpg;base64' + message.media" alt="" />
                }
                <small class="text-shadow-gray-900">
                  {{ message.createdAt | date: "HH:mm" }}
                  @if (message.state === "SENT") {
                    <i class="fas fa-check"></i>
                  } @else {
                    <i class="fas fa-check seen"></i>
                    <i class="fas fa-check seen ml-neg"></i>
                  }
                </small>
              </div>
            </div>
          } @else {
            <div class="message-box friend">
              <div class="flex flex-col items-end">
                @if (message.type === 'TEXT') {
                  <span>{{ message.content }}</span>
                } @else if (message.media) {
                  <img width="200" [src]="'data:image/jpg;base64' + message.media" alt="" />
                }
                <small class="text-shadow-gray-900">
                  {{ message.createdAt | date: "HH:mm" }}
                </small>

              </div>
            </div>
          }
        }
      </div>
      <div class="bg-gray-50 p-2">
        <div class="flex items-center gap-2">
          <i class="fas fa-paperclip cursor-pointer"></i>
          <input
            #inputFile
            type="file"
            [hidden]="true"
            accept=".jpg, .jpeg, .png, .gif, .mp4, .mp3, .mov, .webm, .svg"
            (change)="uploadMedia($event.target)"
          />
          <i class="fa-regular fa-face-smile cursor-pointer"  (click)="showEmojis = !showEmojis"></i>
          @if (showEmojis) {
            <emoji-mart
              [set]="'google'"
              title="Pick up your Emoji"
              emoji="smile"
              class="emoji-panel"
              (emojiClick)="onSelectEmoji($event)"
              ></emoji-mart>
          }
          <input
            type="text"
            class="flex-1 min-w-0 bg-white border border-gray-300 rounded-full px-4 py-2 text-sm text-gray-800 placeholder-gray-400
         focus:outline-none focus:ring-2 focus:ring-[#1ea884]/30 focus:border-[#1ea884]"
            placeholder="Type your message..."
            [(ngModel)]="messageContent"
            (keydown)="keyDown($event)"
            (click)="onClick()"
            autocomplete="off"
          />

          @if (messageContent) {
            <i class="fas fa-paper-plane cursor-pointer" (click)="sendMessage()"></i>
          } @else {
            <i class="fas fa-microphone cursor-pointer"></i>
          }
        </div>
      </div>
    </div>
  </div>
</div>
